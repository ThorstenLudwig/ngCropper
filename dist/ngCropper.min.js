!function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q","$parse",function(e,t){function n(t,n){t=t||{};var i=e.when(t);return t.maximize&&(i=r(t,n)),i}function r(e,t){return i(t).then(function(t){return e.data=t,e})}function i(t){var n=e.defer(),r=new Image;return r.onload=function(){n.resolve({width:r.width,height:r.height})},r.src=t.src,n.promise}return{restrict:"A",scope:{options:"=ngCropperOptions",proxy:"=ngCropperProxy",showEvent:"=ngCropperShow",hideEvent:"=ngCropperHide"},link:function(e,r,i){function o(n){if(e.proxy){var r=t(e.proxy).assign;r(e.$parent,n.cropper.bind(n))}}var h=!1;e.$on(e.showEvent,function(){h||(h=!0,n(e.options,r[0]).then(function(e){o(r),r.cropper(e)}))}),e.$on(e.hideEvent,function(){h&&(h=!1,r.cropper("destroy"))}),e.$watch("options.disabled",function(e){h&&(e&&r.cropper("disable"),e||r.cropper("enable"))})}}}]).service("Cropper",["$q",function(e){function t(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");return n.style.width="20%",90===e||270===e?(n.width=t.height,n.height=t.width):(n.width=t.width,n.height=t.height),r.clearRect(0,0,n.width,n.height),90===e||270===e?r.translate(t.height/2,t.width/2):r.translate(t.width/2,t.height/2),r.rotate(e*Math.PI/180),r.drawImage(t,-t.width/2,-t.height/2),n}function n(t){var n=e.defer(),r=new Image;return r.onload=function(e){n.resolve(e.target)},r.src=t,n.promise}function r(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.display="none",document.body.appendChild(t),t}function i(e){e.parentElement.removeChild(e)}this.encode=function(t){var n=e.defer(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.readAsDataURL(t),n.promise},this.decode=function(e){for(var t=e.split(";")[0],n=t.split(":")[1],r=atob(e.split(",")[1]),i=new Uint8Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})},this.crop=function(e,o){var h=this.decode;return this.encode(e).then(n).then(function(n){var a=r(o),d=a.getContext("2d"),c=t(o.rotate,n);d.drawImage(c,o.x,o.y,o.width,o.height,0,0,o.width,o.height);var u=a.toDataURL(e.type);return i(a),h(u)})},this.scale=function(e,t){var o=this.decode;return this.encode(e).then(n).then(function(n){var h,a,d,c=n.height,u=n.width;angular.isNumber(t)&&(h=t,a=c*h,d=u*h),angular.isObject(t)&&(h=u/c,a=t.height,d=t.width,a&&!d?d=a*h:d&&!a&&(a=d/h));var s=r(t),p=s.getContext("2d");s.height=a,s.width=d,p.drawImage(n,0,0,u,c,0,0,d,a);var g=s.toDataURL(e.type);return i(s),o(g)})}}])}();
